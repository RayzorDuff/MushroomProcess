-- Generated by airtable_export_to_postgres_sql_v3.js
-- 2026-01-25T22:35:59.856Z
BEGIN;
DROP VIEW IF EXISTS "public"."vc_strains" CASCADE;
DROP VIEW IF EXISTS "public"."vc_recipes" CASCADE;
DROP VIEW IF EXISTS "public"."vc_products" CASCADE;
DROP VIEW IF EXISTS "public"."vc_lots" CASCADE;
DROP VIEW IF EXISTS "public"."vc_items" CASCADE;
DROP VIEW IF EXISTS "public"."vc_events" CASCADE;
DROP VIEW IF EXISTS "public"."vc_locations" CASCADE;
DROP VIEW IF EXISTS "public"."vc_sterilization_runs" CASCADE;
DROP VIEW IF EXISTS "public"."vc_print_queue" CASCADE;
DROP VIEW IF EXISTS "public"."vc_ecommerce" CASCADE;
DROP VIEW IF EXISTS "public"."vc_ecommerce_orders" CASCADE;

CREATE VIEW "public"."vc_strains" AS SELECT * FROM "public"."v_strains";

CREATE VIEW "public"."vc_recipes" AS SELECT * FROM "public"."v_recipes";

-- TODO(formula): products.product_id (unsupported)
-- TODO(formula): products.label_title_prod (unsupported)
-- TODO(formula): products.label_subtitle_prod (unsupported)
-- TODO(formula): products.label_packaged_prod (unsupported)
-- TODO(formula): products.label_useby_prod (unsupported)
CREATE VIEW "public"."vc_products" AS
SELECT base.*,
  (NULL) AS "product_id",
  (SELECT COALESCE(array_agg((btbl."name"::text) ORDER BY (btbl."name"::text)) FILTER (WHERE (btbl."name"::text) IS NOT NULL), '{}'::text[]) FROM "public"."_m2m_products_items_item_id" j JOIN "public"."items" btbl ON btbl.nocopk = j."items_id" WHERE j."products_id" = base.nocopk) AS "name",
  (SELECT COALESCE(array_agg((btbl."category"::text) ORDER BY (btbl."category"::text)) FILTER (WHERE (btbl."category"::text) IS NOT NULL), '{}'::text[]) FROM "public"."_m2m_products_items_item_id" j JOIN "public"."items" btbl ON btbl.nocopk = j."items_id" WHERE j."products_id" = base.nocopk) AS "item_category",
  (CASE WHEN (((base.'item_category_mat' = 'freezedriedmushrooms') OR (base.'item_category_mat' = 'fresh_mushrooms'))) THEN (CASE WHEN (base.'origin_strain_regulated') THEN ('https://www.regulatedbusiness.com/') ELSE ('https://www.mybusiness.com/') END) ELSE ('https://www.mybusiness.com/') END) AS "public_link",
  (SELECT COALESCE(array_agg((btbl."name"::text) ORDER BY (btbl."name"::text)) FILTER (WHERE (btbl."name"::text) IS NOT NULL), '{}'::text[]) FROM "public"."_m2m_products_items_package_item" j JOIN "public"."items" btbl ON btbl.nocopk = j."items_id" WHERE j."products_id" = base.nocopk) AS "name_from_package_item",
  (SELECT COALESCE(array_agg((btbl."category"::text) ORDER BY (btbl."category"::text)) FILTER (WHERE (btbl."category"::text) IS NOT NULL), '{}'::text[]) FROM "public"."_m2m_products_items_package_item" j JOIN "public"."items" btbl ON btbl.nocopk = j."items_id" WHERE j."products_id" = base.nocopk) AS "package_item_category",
  '{}'::text[] AS "unit_lbs",
  (SELECT COALESCE(array_agg((btbl."unit_size"::text) ORDER BY (btbl."unit_size"::text)) FILTER (WHERE (btbl."unit_size"::text) IS NOT NULL), '{}'::text[]) FROM "public"."_m2m_products_lots_origin_lots" j JOIN "public"."lots" btbl ON btbl.nocopk = j."lots_id" WHERE j."products_id" = base.nocopk) AS "unit_size",
  '{}'::text[] AS "label_inoc_prod",
  '{}'::text[] AS "label_spawned_prod",
  '{}'::text[] AS "label_proc_prod",
  '{}'::text[] AS "process_type",
  (SELECT COALESCE(array_agg((btbl."species_strain"::text) ORDER BY (btbl."species_strain"::text)) FILTER (WHERE (btbl."species_strain"::text) IS NOT NULL), '{}'::text[]) FROM "public"."_m2m_products_strains_strain_id" j JOIN "public"."strains" btbl ON btbl.nocopk = j."strains_id" WHERE j."products_id" = base.nocopk) AS "species_strain",
  (SELECT COALESCE(array_agg((btbl."regulated"::text) ORDER BY (btbl."regulated"::text)) FILTER (WHERE (btbl."regulated"::text) IS NOT NULL), '{}'::text[]) FROM "public"."_m2m_products_strains_strain_id" j JOIN "public"."strains" btbl ON btbl.nocopk = j."strains_id" WHERE j."products_id" = base.nocopk) AS "origin_strain_regulated",
  (CASE WHEN (base.'origin_strain_regulated') THEN (CASE WHEN (((base.'item_category_mat' = 'freezedriedmushrooms') OR (base.'item_category_mat' = 'fresh_mushrooms') OR (base.'item_category_mat' = 'freezer_tray') OR (base.'item_category_mat' = 'fresh_tray'))) THEN ('Regulated Business') ELSE ('My Business') END) ELSE ('My Business') END) AS "label_company_prod",
  (CASE WHEN (base.'origin_strain_regulated') THEN (CASE WHEN (((base.'item_category_mat' = 'freezedriedmushrooms') OR (base.'item_category_mat' = 'fresh_mushrooms') OR (base.'item_category_mat' = 'freezer_tray') OR (base.'item_category_mat' = 'fresh_tray'))) THEN ('RegulatedBusinessAddressAndContact') ELSE ('MyBuinessAddressAndContact') END) ELSE ('MyBuinessAddressAndContact') END) AS "label_companyaddress_prod",
  (CASE WHEN (base.'origin_strain_regulated') THEN (CASE WHEN (((base.'item_category_mat' = 'freezedriedmushrooms') OR (base.'item_category_mat' = 'fresh_mushrooms') OR (base.'item_category_mat' = 'freezer_tray') OR (base.'item_category_mat' = 'fresh_tray') OR (base.'item_category_mat' = 'fruitingblock'))) THEN ('') ELSE ('Disclaimer: Psilocybin is classified as a Schedule I controlled substance by the U.S. Drug Enforcement Administration (DEA). Unauthorized cultivation, possession, or distribution of psilocybin-containing mushrooms is illegal in most states. It is the responsibility of the buyer to research and comply with all local, state, and federal laws regarding mushroom cultivation. Please consult your local laws carefully before any attempt to grow mushrooms, as penalties for non-compliance can be significant.') END) ELSE ('') END) AS "label_disclaimer_prod",
  (CASE WHEN (base.'origin_strain_regulated') THEN (CASE WHEN (((base.'item_category_mat' = 'freezedriedmushrooms') OR (base.'item_category_mat' = 'fresh_mushrooms') OR (base.'item_category_mat' = 'freezer_tray') OR (base.'item_category_mat' = 'fresh_tray'))) THEN ('') ELSE (CASE WHEN (base.'item_category_mat' = 'fruiting_block') THEN ('MyBusinessOffering') ELSE ('') END) END) ELSE (CASE WHEN (((base.'item_category_mat' = 'freezedriedmushrooms') OR (base.'item_category_mat' = 'fresh_mushrooms') OR (base.'item_category_mat' = 'fruiting_block'))) THEN ('MyBusinessOffering') ELSE ('') END) END) AS "label_companyinfo_prod",
  (CASE WHEN (base.'origin_strain_regulated') THEN (CASE WHEN (((base.'item_category_mat' = 'freezedriedmushrooms') OR (base.'item_category_mat' = 'fresh_mushrooms') OR (base.'item_category_mat' = 'freezer_tray') OR (base.'item_category_mat' = 'fresh_tray'))) THEN ('') ELSE (CASE WHEN (((base.'item_category_mat' = 'freezedriedmushrooms') OR (base.'item_category_mat' = 'fresh_mushrooms'))) THEN ('This product was produced in a home kitchen that is not subject to state licensure or inspection and that may also contain common food allergies such as tree nuts, peanuts, eggs, soy, wheat, milk, fish, and crustacean shellfish. This product is not intended for resale.') ELSE (CASE WHEN (base.'item_category_mat' = 'fruiting_block') THEN ('This product contains ingredients designed for mushroom cultivation. This product is not intended for human consumption.') ELSE ('') END) END) END) ELSE (CASE WHEN (((base.'item_category_mat' = 'freezedriedmushrooms') OR (base.'item_category_mat' = 'fresh_mushrooms'))) THEN ('This product was produced in a home kitchen that is not subject to state licensure or inspection and that may also contain common food allergies such as tree nuts, peanuts, eggs, soy, wheat, milk, fish, and crustacean shellfish. This product is not intended for resale.') ELSE (CASE WHEN (base.'item_category_mat' = 'fruiting_block') THEN ('This product contains ingredients designed for mushroom cultivation. This product is not intended for human consumption.') ELSE ('') END) END) END) AS "label_cottage_prod",
  (NULL) AS "label_title_prod",
  (NULL) AS "label_subtitle_prod",
  (base.'product_id') AS "label_footer_prod",
  (NULL) AS "label_packaged_prod",
  (NULL) AS "label_useby_prod"
FROM "public"."v_products" base;

-- TODO(formula): lots.lot_id (unsupported)
-- TODO(rollup): lots.inoculated_at (from grain_inputs) (Airtable rollup aggregation formula not present in tables_dump)
-- TODO(formula): lots.name (from item_id) (from grain_inputs) (unsupported)
-- TODO(formula): lots.name (from item_id) (from substrate_inputs) (unsupported)
-- TODO(formula): lots.process_type (from steri_run_id) (from substrate_inputs) (unsupported)
-- TODO(formula): lots.unit_lbs (unsupported)
-- TODO(rollup): lots.spawned_date (Airtable rollup aggregation formula not present in tables_dump)
-- TODO(formula): lots.label_inoc_line (unsupported)
-- TODO(formula): lots.label_spawned_line (unsupported)
-- TODO(formula): lots.label_useby_line (unsupported)
-- TODO(formula): lots.label_title_lot (unsupported)
-- TODO(formula): lots.label_subtitle_lot (unsupported)
-- TODO(formula): lots.label_proc_line (unsupported)
-- TODO(formula): lots.label_graininputblocks_line (unsupported)
-- TODO(rollup): lots.last_inoculation_date (Airtable rollup aggregation formula not present in tables_dump)
-- TODO(formula): lots.public_link (unsupported)
-- TODO(formula): lots.public_link_dark_room (unsupported)
-- TODO(formula): lots.public_link_fruiting (unsupported)
-- TODO(formula): lots.public_link_harvest (unsupported)
-- TODO(formula): lots.public_link_spawn_to_bulk (unsupported)
-- TODO(formula): lots.public_link_inoculate_flask (unsupported)
-- TODO(formula): lots.public_link_inoculate_grain (unsupported)
-- TODO(formula): lots.public_link_freeze_dry_package (unsupported)
-- TODO(formula): lots.public_link_substrate_package (unsupported)
-- TODO(formula): lots.public_link_lot_lineage (unsupported)
-- TODO(rollup): lots.first_event_date (Airtable rollup aggregation formula not present in tables_dump)
-- TODO(rollup): lots.last_event_date (Airtable rollup aggregation formula not present in tables_dump)
CREATE VIEW "public"."vc_lots" AS
SELECT base.*,
  (NULL) AS "lot_id",
  (SELECT COALESCE(array_agg((btbl."name"::text) ORDER BY (btbl."name"::text)) FILTER (WHERE (btbl."name"::text) IS NOT NULL), '{}'::text[]) FROM "public"."_m2m_lots_items_item_id" j JOIN "public"."items" btbl ON btbl.nocopk = j."items_id" WHERE j."lots_id" = base.nocopk) AS "item_name",
  (SELECT COALESCE(array_agg((btbl."name"::text) ORDER BY (btbl."name"::text)) FILTER (WHERE (btbl."name"::text) IS NOT NULL), '{}'::text[]) FROM "public"."_m2m_lots_recipes_recipe_id" j JOIN "public"."recipes" btbl ON btbl.nocopk = j."recipes_id" WHERE j."lots_id" = base.nocopk) AS "recipe_name",
  (SELECT COALESCE(array_agg((btbl."regulated"::text) ORDER BY (btbl."regulated"::text)) FILTER (WHERE (btbl."regulated"::text) IS NOT NULL), '{}'::text[]) FROM "public"."_m2m_lots_strains_strain_id" j JOIN "public"."strains" btbl ON btbl.nocopk = j."strains_id" WHERE j."lots_id" = base.nocopk) AS "regulated_from_strain_id",
  (SELECT COALESCE(array_agg((btbl."species_strain"::text) ORDER BY (btbl."species_strain"::text)) FILTER (WHERE (btbl."species_strain"::text) IS NOT NULL), '{}'::text[]) FROM "public"."_m2m_lots_strains_strain_id" j JOIN "public"."strains" btbl ON btbl.nocopk = j."strains_id" WHERE j."lots_id" = base.nocopk) AS "strain_species_strain",
  (SELECT COALESCE(array_agg((btbl."process_type"::text) ORDER BY (btbl."process_type"::text)) FILTER (WHERE (btbl."process_type"::text) IS NOT NULL), '{}'::text[]) FROM "public"."_m2m_lots_sterilization_runs_steri_run_id" j JOIN "public"."sterilization_runs" btbl ON btbl.nocopk = j."sterilization_runs_id" WHERE j."lots_id" = base.nocopk) AS "process_type_from_steri_run_id",
  (SELECT COALESCE(array_agg((btbl."category"::text) ORDER BY (btbl."category"::text)) FILTER (WHERE (btbl."category"::text) IS NOT NULL), '{}'::text[]) FROM "public"."_m2m_lots_items_item_id" j JOIN "public"."items" btbl ON btbl.nocopk = j."items_id" WHERE j."lots_id" = base.nocopk) AS "item_category",
  '{}'::text[] AS "strain_species_strain_from_lc_lot_id",
  (SELECT COALESCE(array_agg((btbl."vendor_name"::text) ORDER BY (btbl."vendor_name"::text)) FILTER (WHERE (btbl."vendor_name"::text) IS NOT NULL), '{}'::text[]) FROM "public"."_m2m_lots_lots_target_lot_ids" j JOIN "public"."lots" btbl ON btbl.nocopk = j."lots1_id" WHERE j."lots_id" = base.nocopk) AS "vendor_name_from_lc_lot_id",
  (SELECT COALESCE(array_agg((btbl."item_name_mat"::text) ORDER BY (btbl."item_name_mat"::text)) FILTER (WHERE (btbl."item_name_mat"::text) IS NOT NULL), '{}'::text[]) FROM "public"."_m2m_lots_lots_grain_inputs" j JOIN "public"."lots" btbl ON btbl.nocopk = j."lots1_id" WHERE j."lots_id" = base.nocopk) AS "item_name_mat_from_grain_inputs",
  (SELECT COALESCE(array_agg((btbl."inoculated_at"::text) ORDER BY (btbl."inoculated_at"::text)) FILTER (WHERE (btbl."inoculated_at"::text) IS NOT NULL), '{}'::text[]) FROM "public"."_m2m_lots_lots_grain_inputs" j JOIN "public"."lots" btbl ON btbl.nocopk = j."lots1_id" WHERE j."lots_id" = base.nocopk) AS "inoculated_at_from_grain_inputs",
  (NULL) AS "name_from_item_id_from_grain_inputs",
  (SELECT COALESCE(array_agg((btbl."process_type_mat"::text) ORDER BY (btbl."process_type_mat"::text)) FILTER (WHERE (btbl."process_type_mat"::text) IS NOT NULL), '{}'::text[]) FROM "public"."_m2m_lots_lots_substrate_inputs" j JOIN "public"."lots" btbl ON btbl.nocopk = j."lots1_id" WHERE j."lots_id" = base.nocopk) AS "process_type_mat_from_substrate_inputs",
  (SELECT COALESCE(array_agg((btbl."item_name_mat"::text) ORDER BY (btbl."item_name_mat"::text)) FILTER (WHERE (btbl."item_name_mat"::text) IS NOT NULL), '{}'::text[]) FROM "public"."_m2m_lots_lots_substrate_inputs" j JOIN "public"."lots" btbl ON btbl.nocopk = j."lots1_id" WHERE j."lots_id" = base.nocopk) AS "item_name_mat_from_substrate_inputs",
  (NULL) AS "name_from_item_id_from_substrate_inputs",
  (NULL) AS "process_type_from_steri_run_id_from_substrate_inputs",
  (SELECT COALESCE(array_agg((btbl."category"::text) ORDER BY (btbl."category"::text)) FILTER (WHERE (btbl."category"::text) IS NOT NULL), '{}'::text[]) FROM "public"."_m2m_lots_items_harvest_item" j JOIN "public"."items" btbl ON btbl.nocopk = j."items_id" WHERE j."lots_id" = base.nocopk) AS "harvest_item_category",
  '{}'::text[] AS "name_from_products",
  '{}'::text[] AS "category_from_item_id_from_products",
  ('My Business') AS "label_company_lot",
  (NULL) AS "unit_lbs",
  (SELECT COALESCE(array_agg((btbl."timestamp"::text) ORDER BY (btbl."timestamp"::text)) FILTER (WHERE (btbl."timestamp"::text) IS NOT NULL), '{}'::text[]) FROM "public"."_m2m_lots_events_events" j JOIN "public"."events" btbl ON btbl.nocopk = j."events_id" WHERE j."lots_id" = base.nocopk) AS "spawned_date",
  (NULL) AS "label_inoc_line",
  (NULL) AS "label_spawned_line",
  (NULL) AS "label_useby_line",
  (NULL) AS "label_title_lot",
  (NULL) AS "label_subtitle_lot",
  ('Lot: ' || base.'lot_id') AS "label_footer_lot",
  (NULL) AS "label_proc_line",
  (NULL) AS "label_graininputblocks_line",
  (CASE WHEN (base.'spawned_date') THEN (base.'process_type_from_steri_run_id_from_substrate_inputs' || 'd ' || base.'name_from_item_id_from_substrate_inputs') ELSE ('') END) AS "label_substrateinputblocks_line",
  (SELECT COALESCE(array_agg((btbl."timestamp"::text) ORDER BY (btbl."timestamp"::text)) FILTER (WHERE (btbl."timestamp"::text) IS NOT NULL), '{}'::text[]) FROM "public"."_m2m_lots_events_events" j JOIN "public"."events" btbl ON btbl.nocopk = j."events_id" WHERE j."lots_id" = base.nocopk) AS "last_inoculation_date",
  (NULL) AS "public_link",
  (NULL) AS "public_link_dark_room",
  (NULL) AS "public_link_fruiting",
  (NULL) AS "public_link_harvest",
  (NULL) AS "public_link_spawn_to_bulk",
  (NULL) AS "public_link_inoculate_flask",
  (NULL) AS "public_link_inoculate_grain",
  (NULL) AS "public_link_freeze_dry_package",
  (NULL) AS "public_link_substrate_package",
  (NULL) AS "public_link_lot_lineage",
  (SELECT COALESCE(array_agg((btbl."timestamp"::text) ORDER BY (btbl."timestamp"::text)) FILTER (WHERE (btbl."timestamp"::text) IS NOT NULL), '{}'::text[]) FROM "public"."_m2m_lots_events_events" j JOIN "public"."events" btbl ON btbl.nocopk = j."events_id" WHERE j."lots_id" = base.nocopk) AS "first_event_date",
  (SELECT COALESCE(array_agg((btbl."timestamp"::text) ORDER BY (btbl."timestamp"::text)) FILTER (WHERE (btbl."timestamp"::text) IS NOT NULL), '{}'::text[]) FROM "public"."_m2m_lots_events_events" j JOIN "public"."events" btbl ON btbl.nocopk = j."events_id" WHERE j."lots_id" = base.nocopk) AS "last_event_date"
FROM "public"."v_lots" base;

CREATE VIEW "public"."vc_items" AS SELECT * FROM "public"."v_items";

-- TODO(formula): events.event_id (unsupported)
CREATE VIEW "public"."vc_events" AS
SELECT base.*,
  (NULL) AS "event_id",
  (SELECT COALESCE(array_agg((btbl."status"::text) ORDER BY (btbl."status"::text)) FILTER (WHERE (btbl."status"::text) IS NOT NULL), '{}'::text[]) FROM "public"."_m2m_events_lots_lot_id" j JOIN "public"."lots" btbl ON btbl.nocopk = j."lots_id" WHERE j."events_id" = base.nocopk) AS "status_from_lot_id",
  '{}'::text[] AS "storage_location_from_product_id",
  '{}'::text[] AS "grain_inputs_from_lot_id",
  '{}'::text[] AS "substrate_inputs_from_lot_id",
  '{}'::text[] AS "vendor_name_from_lc_lot_id_from_lot_id",
  '{}'::text[] AS "strain_species_strain_from_lot_id",
  (CASE WHEN (base.'timestamp') THEN (base.'timestamp') ELSE (base."nc_created_at") END) AS "event_time_for_rollup"
FROM "public"."v_events" base;

CREATE VIEW "public"."vc_locations" AS SELECT * FROM "public"."v_locations";

-- TODO(formula): sterilization_runs.steri_run_id (unsupported)
CREATE VIEW "public"."vc_sterilization_runs" AS
SELECT base.*,
  (NULL) AS "steri_run_id",
  (SELECT COALESCE(array_agg((btbl."default_unit_size"::text) ORDER BY (btbl."default_unit_size"::text)) FILTER (WHERE (btbl."default_unit_size"::text) IS NOT NULL), '{}'::text[]) FROM "public"."_m2m_sterilization_runs_items_planned_item" j JOIN "public"."items" btbl ON btbl.nocopk = j."items_id" WHERE j."sterilization_runs_id" = base.nocopk) AS "default_unit_size_from_planned_item",
  (SELECT COALESCE(array_agg((btbl."item_id"::text) ORDER BY (btbl."item_id"::text)) FILTER (WHERE (btbl."item_id"::text) IS NOT NULL), '{}'::text[]) FROM "public"."_m2m_sterilization_runs_items_planned_item" j JOIN "public"."items" btbl ON btbl.nocopk = j."items_id" WHERE j."sterilization_runs_id" = base.nocopk) AS "planned_item_id",
  (SELECT COALESCE(array_agg((btbl."name"::text) ORDER BY (btbl."name"::text)) FILTER (WHERE (btbl."name"::text) IS NOT NULL), '{}'::text[]) FROM "public"."_m2m_sterilization_runs_items_planned_item" j JOIN "public"."items" btbl ON btbl.nocopk = j."items_id" WHERE j."sterilization_runs_id" = base.nocopk) AS "planned_item_name",
  (SELECT COALESCE(array_agg((btbl."recipe_id"::text) ORDER BY (btbl."recipe_id"::text)) FILTER (WHERE (btbl."recipe_id"::text) IS NOT NULL), '{}'::text[]) FROM "public"."_m2m_sterilization_runs_recipes_planned_recipe" j JOIN "public"."recipes" btbl ON btbl.nocopk = j."recipes_id" WHERE j."sterilization_runs_id" = base.nocopk) AS "recipe_id_from_planned_recipe",
  (SELECT COALESCE(array_agg((btbl."name"::text) ORDER BY (btbl."name"::text)) FILTER (WHERE (btbl."name"::text) IS NOT NULL), '{}'::text[]) FROM "public"."_m2m_sterilization_runs_recipes_planned_recipe" j JOIN "public"."recipes" btbl ON btbl.nocopk = j."recipes_id" WHERE j."sterilization_runs_id" = base.nocopk) AS "name_from_planned_recipe"
FROM "public"."v_sterilization_runs" base;

-- TODO(formula): print_queue.print_id (unsupported)
CREATE VIEW "public"."vc_print_queue" AS
SELECT base.*,
  (NULL) AS "print_id",
  (SELECT COALESCE(array_agg((btbl."item_category_mat"::text) ORDER BY (btbl."item_category_mat"::text)) FILTER (WHERE (btbl."item_category_mat"::text) IS NOT NULL), '{}'::text[]) FROM "public"."_m2m_print_queue_lots_lot_id" j JOIN "public"."lots" btbl ON btbl.nocopk = j."lots_id" WHERE j."print_queue_id" = base.nocopk) AS "item_category_mat_from_lot_id",
  '{}'::text[] AS "public_link_from_lot_id",
  (SELECT COALESCE(array_agg(('My Business') ORDER BY ('My Business')) FILTER (WHERE ('My Business') IS NOT NULL), '{}'::text[]) FROM "public"."_m2m_print_queue_lots_lot_id" j JOIN "public"."lots" btbl ON btbl.nocopk = j."lots_id" WHERE j."print_queue_id" = base.nocopk) AS "label_company_lot_from_lot_id",
  (SELECT COALESCE(array_agg((btbl."item_category_mat"::text) ORDER BY (btbl."item_category_mat"::text)) FILTER (WHERE (btbl."item_category_mat"::text) IS NOT NULL), '{}'::text[]) FROM "public"."_m2m_print_queue_products_product_id" j JOIN "public"."products" btbl ON btbl.nocopk = j."products_id" WHERE j."print_queue_id" = base.nocopk) AS "item_category_mat_from_product_id",
  (SELECT COALESCE(array_agg((CASE WHEN (((btbl.'item_category_mat' = 'freezedriedmushrooms') OR (btbl.'item_category_mat' = 'fresh_mushrooms'))) THEN (CASE WHEN (btbl.'origin_strain_regulated') THEN ('https://www.regulatedbusiness.com/') ELSE ('https://www.mybusiness.com/') END) ELSE ('https://www.mybusiness.com/') END) ORDER BY (CASE WHEN (((btbl.'item_category_mat' = 'freezedriedmushrooms') OR (btbl.'item_category_mat' = 'fresh_mushrooms'))) THEN (CASE WHEN (btbl.'origin_strain_regulated') THEN ('https://www.regulatedbusiness.com/') ELSE ('https://www.mybusiness.com/') END) ELSE ('https://www.mybusiness.com/') END)) FILTER (WHERE (CASE WHEN (((btbl.'item_category_mat' = 'freezedriedmushrooms') OR (btbl.'item_category_mat' = 'fresh_mushrooms'))) THEN (CASE WHEN (btbl.'origin_strain_regulated') THEN ('https://www.regulatedbusiness.com/') ELSE ('https://www.mybusiness.com/') END) ELSE ('https://www.mybusiness.com/') END) IS NOT NULL), '{}'::text[]) FROM "public"."_m2m_print_queue_products_product_id" j JOIN "public"."products" btbl ON btbl.nocopk = j."products_id" WHERE j."print_queue_id" = base.nocopk) AS "public_link_from_product_id",
  (CASE WHEN (base.'source_kind' = 'steri_sheet') THEN ('SHEETS') ELSE (CASE WHEN (((base.'item_category_mat_from_product_id' = 'fresh_mushrooms') OR (base.'item_category_mat_from_product_id' = 'freezer_tray') OR (base.'item_category_mat_from_product_id' = 'fresh_tray') OR (base.'item_category_mat_from_lot_id' = 'fresh_mushrooms') OR (base.'item_category_mat_from_lot_id' = 'freezer_tray') OR (base.'item_category_mat_from_lot_id' = 'fresh_tray'))) THEN ('TRAYS') ELSE ('ZEBRA') END) END) AS "print_target",
  (SELECT COALESCE(array_agg((CASE WHEN (btbl.'spawned_date') THEN (btbl.'process_type_from_steri_run_id_from_substrate_inputs' || 'd ' || btbl.'name_from_item_id_from_substrate_inputs') ELSE ('') END) ORDER BY (CASE WHEN (btbl.'spawned_date') THEN (btbl.'process_type_from_steri_run_id_from_substrate_inputs' || 'd ' || btbl.'name_from_item_id_from_substrate_inputs') ELSE ('') END)) FILTER (WHERE (CASE WHEN (btbl.'spawned_date') THEN (btbl.'process_type_from_steri_run_id_from_substrate_inputs' || 'd ' || btbl.'name_from_item_id_from_substrate_inputs') ELSE ('') END) IS NOT NULL), '{}'::text[]) FROM "public"."_m2m_print_queue_lots_lot_id" j JOIN "public"."lots" btbl ON btbl.nocopk = j."lots_id" WHERE j."print_queue_id" = base.nocopk) AS "label_substrateinputblocks_line_from_lot_id",
  '{}'::text[] AS "label_graininputblocks_line_from_lot_id",
  (SELECT COALESCE(array_agg(('Lot: ' || btbl.'lot_id') ORDER BY ('Lot: ' || btbl.'lot_id')) FILTER (WHERE ('Lot: ' || btbl.'lot_id') IS NOT NULL), '{}'::text[]) FROM "public"."_m2m_print_queue_lots_lot_id" j JOIN "public"."lots" btbl ON btbl.nocopk = j."lots_id" WHERE j."print_queue_id" = base.nocopk) AS "label_footer_lot_from_lot_id",
  '{}'::text[] AS "label_subtitle_lot_from_lot_id",
  '{}'::text[] AS "label_title_lot_from_lot_id",
  (SELECT COALESCE(array_agg((btbl."label_template"::text) ORDER BY (btbl."label_template"::text)) FILTER (WHERE (btbl."label_template"::text) IS NOT NULL), '{}'::text[]) FROM "public"."_m2m_print_queue_lots_lot_id" j JOIN "public"."lots" btbl ON btbl.nocopk = j."lots_id" WHERE j."print_queue_id" = base.nocopk) AS "label_template_from_lot_id",
  '{}'::text[] AS "label_useby_line_from_lot_id",
  '{}'::text[] AS "label_spawned_line_from_lot_id",
  '{}'::text[] AS "label_inoc_line_from_lot_id",
  '{}'::text[] AS "label_proc_line_from_lot_id",
  (SELECT COALESCE(array_agg((CASE WHEN (btbl.'origin_strain_regulated') THEN (CASE WHEN (((btbl.'item_category_mat' = 'freezedriedmushrooms') OR (btbl.'item_category_mat' = 'fresh_mushrooms') OR (btbl.'item_category_mat' = 'freezer_tray') OR (btbl.'item_category_mat' = 'fresh_tray'))) THEN ('Regulated Business') ELSE ('My Business') END) ELSE ('My Business') END) ORDER BY (CASE WHEN (btbl.'origin_strain_regulated') THEN (CASE WHEN (((btbl.'item_category_mat' = 'freezedriedmushrooms') OR (btbl.'item_category_mat' = 'fresh_mushrooms') OR (btbl.'item_category_mat' = 'freezer_tray') OR (btbl.'item_category_mat' = 'fresh_tray'))) THEN ('Regulated Business') ELSE ('My Business') END) ELSE ('My Business') END)) FILTER (WHERE (CASE WHEN (btbl.'origin_strain_regulated') THEN (CASE WHEN (((btbl.'item_category_mat' = 'freezedriedmushrooms') OR (btbl.'item_category_mat' = 'fresh_mushrooms') OR (btbl.'item_category_mat' = 'freezer_tray') OR (btbl.'item_category_mat' = 'fresh_tray'))) THEN ('Regulated Business') ELSE ('My Business') END) ELSE ('My Business') END) IS NOT NULL), '{}'::text[]) FROM "public"."_m2m_print_queue_products_product_id" j JOIN "public"."products" btbl ON btbl.nocopk = j."products_id" WHERE j."print_queue_id" = base.nocopk) AS "label_company_prod_from_product_id",
  '{}'::text[] AS "label_title_prod_from_product_id",
  '{}'::text[] AS "label_subtitle_prod_from_product_id",
  (SELECT COALESCE(array_agg((btbl.'product_id') ORDER BY (btbl.'product_id')) FILTER (WHERE (btbl.'product_id') IS NOT NULL), '{}'::text[]) FROM "public"."_m2m_print_queue_products_product_id" j JOIN "public"."products" btbl ON btbl.nocopk = j."products_id" WHERE j."print_queue_id" = base.nocopk) AS "label_footer_prod_from_product_id",
  (SELECT COALESCE(array_agg((CASE WHEN (btbl.'origin_strain_regulated') THEN (CASE WHEN (((btbl.'item_category_mat' = 'freezedriedmushrooms') OR (btbl.'item_category_mat' = 'fresh_mushrooms') OR (btbl.'item_category_mat' = 'freezer_tray') OR (btbl.'item_category_mat' = 'fresh_tray'))) THEN ('') ELSE (CASE WHEN (((btbl.'item_category_mat' = 'freezedriedmushrooms') OR (btbl.'item_category_mat' = 'fresh_mushrooms'))) THEN ('This product was produced in a home kitchen that is not subject to state licensure or inspection and that may also contain common food allergies such as tree nuts, peanuts, eggs, soy, wheat, milk, fish, and crustacean shellfish. This product is not intended for resale.') ELSE (CASE WHEN (btbl.'item_category_mat' = 'fruiting_block') THEN ('This product contains ingredients designed for mushroom cultivation. This product is not intended for human consumption.') ELSE ('') END) END) END) ELSE (CASE WHEN (((btbl.'item_category_mat' = 'freezedriedmushrooms') OR (btbl.'item_category_mat' = 'fresh_mushrooms'))) THEN ('This product was produced in a home kitchen that is not subject to state licensure or inspection and that may also contain common food allergies such as tree nuts, peanuts, eggs, soy, wheat, milk, fish, and crustacean shellfish. This product is not intended for resale.') ELSE (CASE WHEN (btbl.'item_category_mat' = 'fruiting_block') THEN ('This product contains ingredients designed for mushroom cultivation. This product is not intended for human consumption.') ELSE ('') END) END) END) ORDER BY (CASE WHEN (btbl.'origin_strain_regulated') THEN (CASE WHEN (((btbl.'item_category_mat' = 'freezedriedmushrooms') OR (btbl.'item_category_mat' = 'fresh_mushrooms') OR (btbl.'item_category_mat' = 'freezer_tray') OR (btbl.'item_category_mat' = 'fresh_tray'))) THEN ('') ELSE (CASE WHEN (((btbl.'item_category_mat' = 'freezedriedmushrooms') OR (btbl.'item_category_mat' = 'fresh_mushrooms'))) THEN ('This product was produced in a home kitchen that is not subject to state licensure or inspection and that may also contain common food allergies such as tree nuts, peanuts, eggs, soy, wheat, milk, fish, and crustacean shellfish. This product is not intended for resale.') ELSE (CASE WHEN (btbl.'item_category_mat' = 'fruiting_block') THEN ('This product contains ingredients designed for mushroom cultivation. This product is not intended for human consumption.') ELSE ('') END) END) END) ELSE (CASE WHEN (((btbl.'item_category_mat' = 'freezedriedmushrooms') OR (btbl.'item_category_mat' = 'fresh_mushrooms'))) THEN ('This product was produced in a home kitchen that is not subject to state licensure or inspection and that may also contain common food allergies such as tree nuts, peanuts, eggs, soy, wheat, milk, fish, and crustacean shellfish. This product is not intended for resale.') ELSE (CASE WHEN (btbl.'item_category_mat' = 'fruiting_block') THEN ('This product contains ingredients designed for mushroom cultivation. This product is not intended for human consumption.') ELSE ('') END) END) END)) FILTER (WHERE (CASE WHEN (btbl.'origin_strain_regulated') THEN (CASE WHEN (((btbl.'item_category_mat' = 'freezedriedmushrooms') OR (btbl.'item_category_mat' = 'fresh_mushrooms') OR (btbl.'item_category_mat' = 'freezer_tray') OR (btbl.'item_category_mat' = 'fresh_tray'))) THEN ('') ELSE (CASE WHEN (((btbl.'item_category_mat' = 'freezedriedmushrooms') OR (btbl.'item_category_mat' = 'fresh_mushrooms'))) THEN ('This product was produced in a home kitchen that is not subject to state licensure or inspection and that may also contain common food allergies such as tree nuts, peanuts, eggs, soy, wheat, milk, fish, and crustacean shellfish. This product is not intended for resale.') ELSE (CASE WHEN (btbl.'item_category_mat' = 'fruiting_block') THEN ('This product contains ingredients designed for mushroom cultivation. This product is not intended for human consumption.') ELSE ('') END) END) END) ELSE (CASE WHEN (((btbl.'item_category_mat' = 'freezedriedmushrooms') OR (btbl.'item_category_mat' = 'fresh_mushrooms'))) THEN ('This product was produced in a home kitchen that is not subject to state licensure or inspection and that may also contain common food allergies such as tree nuts, peanuts, eggs, soy, wheat, milk, fish, and crustacean shellfish. This product is not intended for resale.') ELSE (CASE WHEN (btbl.'item_category_mat' = 'fruiting_block') THEN ('This product contains ingredients designed for mushroom cultivation. This product is not intended for human consumption.') ELSE ('') END) END) END) IS NOT NULL), '{}'::text[]) FROM "public"."_m2m_print_queue_products_product_id" j JOIN "public"."products" btbl ON btbl.nocopk = j."products_id" WHERE j."print_queue_id" = base.nocopk) AS "label_cottage_prod_from_product_id",
  (SELECT COALESCE(array_agg((CASE WHEN (btbl.'origin_strain_regulated') THEN (CASE WHEN (((btbl.'item_category_mat' = 'freezedriedmushrooms') OR (btbl.'item_category_mat' = 'fresh_mushrooms') OR (btbl.'item_category_mat' = 'freezer_tray') OR (btbl.'item_category_mat' = 'fresh_tray'))) THEN ('') ELSE (CASE WHEN (btbl.'item_category_mat' = 'fruiting_block') THEN ('MyBusinessOffering') ELSE ('') END) END) ELSE (CASE WHEN (((btbl.'item_category_mat' = 'freezedriedmushrooms') OR (btbl.'item_category_mat' = 'fresh_mushrooms') OR (btbl.'item_category_mat' = 'fruiting_block'))) THEN ('MyBusinessOffering') ELSE ('') END) END) ORDER BY (CASE WHEN (btbl.'origin_strain_regulated') THEN (CASE WHEN (((btbl.'item_category_mat' = 'freezedriedmushrooms') OR (btbl.'item_category_mat' = 'fresh_mushrooms') OR (btbl.'item_category_mat' = 'freezer_tray') OR (btbl.'item_category_mat' = 'fresh_tray'))) THEN ('') ELSE (CASE WHEN (btbl.'item_category_mat' = 'fruiting_block') THEN ('MyBusinessOffering') ELSE ('') END) END) ELSE (CASE WHEN (((btbl.'item_category_mat' = 'freezedriedmushrooms') OR (btbl.'item_category_mat' = 'fresh_mushrooms') OR (btbl.'item_category_mat' = 'fruiting_block'))) THEN ('MyBusinessOffering') ELSE ('') END) END)) FILTER (WHERE (CASE WHEN (btbl.'origin_strain_regulated') THEN (CASE WHEN (((btbl.'item_category_mat' = 'freezedriedmushrooms') OR (btbl.'item_category_mat' = 'fresh_mushrooms') OR (btbl.'item_category_mat' = 'freezer_tray') OR (btbl.'item_category_mat' = 'fresh_tray'))) THEN ('') ELSE (CASE WHEN (btbl.'item_category_mat' = 'fruiting_block') THEN ('MyBusinessOffering') ELSE ('') END) END) ELSE (CASE WHEN (((btbl.'item_category_mat' = 'freezedriedmushrooms') OR (btbl.'item_category_mat' = 'fresh_mushrooms') OR (btbl.'item_category_mat' = 'fruiting_block'))) THEN ('MyBusinessOffering') ELSE ('') END) END) IS NOT NULL), '{}'::text[]) FROM "public"."_m2m_print_queue_products_product_id" j JOIN "public"."products" btbl ON btbl.nocopk = j."products_id" WHERE j."print_queue_id" = base.nocopk) AS "label_companyinfo_prod_from_product_id",
  (SELECT COALESCE(array_agg((CASE WHEN (btbl.'origin_strain_regulated') THEN (CASE WHEN (((btbl.'item_category_mat' = 'freezedriedmushrooms') OR (btbl.'item_category_mat' = 'fresh_mushrooms') OR (btbl.'item_category_mat' = 'freezer_tray') OR (btbl.'item_category_mat' = 'fresh_tray') OR (btbl.'item_category_mat' = 'fruitingblock'))) THEN ('') ELSE ('Disclaimer: Psilocybin is classified as a Schedule I controlled substance by the U.S. Drug Enforcement Administration (DEA). Unauthorized cultivation, possession, or distribution of psilocybin-containing mushrooms is illegal in most states. It is the responsibility of the buyer to research and comply with all local, state, and federal laws regarding mushroom cultivation. Please consult your local laws carefully before any attempt to grow mushrooms, as penalties for non-compliance can be significant.') END) ELSE ('') END) ORDER BY (CASE WHEN (btbl.'origin_strain_regulated') THEN (CASE WHEN (((btbl.'item_category_mat' = 'freezedriedmushrooms') OR (btbl.'item_category_mat' = 'fresh_mushrooms') OR (btbl.'item_category_mat' = 'freezer_tray') OR (btbl.'item_category_mat' = 'fresh_tray') OR (btbl.'item_category_mat' = 'fruitingblock'))) THEN ('') ELSE ('Disclaimer: Psilocybin is classified as a Schedule I controlled substance by the U.S. Drug Enforcement Administration (DEA). Unauthorized cultivation, possession, or distribution of psilocybin-containing mushrooms is illegal in most states. It is the responsibility of the buyer to research and comply with all local, state, and federal laws regarding mushroom cultivation. Please consult your local laws carefully before any attempt to grow mushrooms, as penalties for non-compliance can be significant.') END) ELSE ('') END)) FILTER (WHERE (CASE WHEN (btbl.'origin_strain_regulated') THEN (CASE WHEN (((btbl.'item_category_mat' = 'freezedriedmushrooms') OR (btbl.'item_category_mat' = 'fresh_mushrooms') OR (btbl.'item_category_mat' = 'freezer_tray') OR (btbl.'item_category_mat' = 'fresh_tray') OR (btbl.'item_category_mat' = 'fruitingblock'))) THEN ('') ELSE ('Disclaimer: Psilocybin is classified as a Schedule I controlled substance by the U.S. Drug Enforcement Administration (DEA). Unauthorized cultivation, possession, or distribution of psilocybin-containing mushrooms is illegal in most states. It is the responsibility of the buyer to research and comply with all local, state, and federal laws regarding mushroom cultivation. Please consult your local laws carefully before any attempt to grow mushrooms, as penalties for non-compliance can be significant.') END) ELSE ('') END) IS NOT NULL), '{}'::text[]) FROM "public"."_m2m_print_queue_products_product_id" j JOIN "public"."products" btbl ON btbl.nocopk = j."products_id" WHERE j."print_queue_id" = base.nocopk) AS "label_disclaimer_prod_from_product_id",
  (SELECT COALESCE(array_agg((CASE WHEN (btbl.'origin_strain_regulated') THEN (CASE WHEN (((btbl.'item_category_mat' = 'freezedriedmushrooms') OR (btbl.'item_category_mat' = 'fresh_mushrooms') OR (btbl.'item_category_mat' = 'freezer_tray') OR (btbl.'item_category_mat' = 'fresh_tray'))) THEN ('RegulatedBusinessAddressAndContact') ELSE ('MyBuinessAddressAndContact') END) ELSE ('MyBuinessAddressAndContact') END) ORDER BY (CASE WHEN (btbl.'origin_strain_regulated') THEN (CASE WHEN (((btbl.'item_category_mat' = 'freezedriedmushrooms') OR (btbl.'item_category_mat' = 'fresh_mushrooms') OR (btbl.'item_category_mat' = 'freezer_tray') OR (btbl.'item_category_mat' = 'fresh_tray'))) THEN ('RegulatedBusinessAddressAndContact') ELSE ('MyBuinessAddressAndContact') END) ELSE ('MyBuinessAddressAndContact') END)) FILTER (WHERE (CASE WHEN (btbl.'origin_strain_regulated') THEN (CASE WHEN (((btbl.'item_category_mat' = 'freezedriedmushrooms') OR (btbl.'item_category_mat' = 'fresh_mushrooms') OR (btbl.'item_category_mat' = 'freezer_tray') OR (btbl.'item_category_mat' = 'fresh_tray'))) THEN ('RegulatedBusinessAddressAndContact') ELSE ('MyBuinessAddressAndContact') END) ELSE ('MyBuinessAddressAndContact') END) IS NOT NULL), '{}'::text[]) FROM "public"."_m2m_print_queue_products_product_id" j JOIN "public"."products" btbl ON btbl.nocopk = j."products_id" WHERE j."print_queue_id" = base.nocopk) AS "label_companyaddress_prod_from_product_id",
  '{}'::text[] AS "label_packaged_prod_from_product_id",
  '{}'::text[] AS "label_useby_prod_from_product_id",
  '{}'::text[] AS "label_proc_prod_from_product_id",
  '{}'::text[] AS "label_spawned_prod_from_product_id",
  '{}'::text[] AS "label_inoc_prod_from_product_id"
FROM "public"."v_print_queue" base;

CREATE VIEW "public"."vc_ecommerce" AS
SELECT base.*,
  '{}'::text[] AS "available_from_products",
  '{}'::text[] AS "available_from_lots"
FROM "public"."v_ecommerce" base;

CREATE VIEW "public"."vc_ecommerce_orders" AS SELECT * FROM "public"."v_ecommerce_orders";

COMMIT;
