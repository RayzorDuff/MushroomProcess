-- Generated by airtable_export_to_postgres_sql_v3.js
-- 2026-01-29T20:01:14.169Z
\set ON_ERROR_STOP on
\set basedir '.'
BEGIN;
SET search_path TO "public";
\copy "strains"("airtable_id","strain_id","species_strain","regulated") FROM :'basedir'/'csv/strains.csv' WITH (FORMAT csv, HEADER true);
\copy "recipes"("airtable_id","recipe_id","name","category","ingredients","notes") FROM :'basedir'/'csv/recipes.csv' WITH (FORMAT csv, HEADER true);
\copy "items"("airtable_id","item_id","name","category","default_unit_size_lb","default_unit_size_ml","default_unit_size_oz","default_unit_size_g","default_unit_size") FROM :'basedir'/'csv/items.csv' WITH (FORMAT csv, HEADER true);
\copy "locations"("airtable_id","name","type","notes") FROM :'basedir'/'csv/locations.csv' WITH (FORMAT csv, HEADER true);
\copy "ecommerce"("airtable_id","name","status","ecwid_sku","sync_to_ecwid","notes","ecwid_category","ecwid_price","ecwid_stock","ecwid_url","ecwid_image") FROM :'basedir'/'csv/ecommerce.csv' WITH (FORMAT csv, HEADER true);

-- Link field: strains.ecommerce -> ecommerce
CREATE TEMP TABLE "_m2m_strains_ecommerce_ecommerce__raw"("a_airtable_id" text, "b_airtable_id" text);
\copy "_m2m_strains_ecommerce_ecommerce__raw"("a_airtable_id","b_airtable_id") FROM :'basedir'/'csv/_m2m_strains_ecommerce_ecommerce__raw.csv' WITH (FORMAT csv, HEADER true);
INSERT INTO "_m2m_strains_ecommerce_ecommerce"("strains_id", "ecommerce_id")
SELECT a.nocopk, b.nocopk
FROM "_m2m_strains_ecommerce_ecommerce__raw" r
JOIN "strains" a ON a.airtable_id = r.a_airtable_id
JOIN "ecommerce" b ON b.airtable_id = r.b_airtable_id;
DROP TABLE "_m2m_strains_ecommerce_ecommerce__raw";

-- Link field: items.ecommerce -> ecommerce
CREATE TEMP TABLE "_m2m_items_ecommerce_ecommerce__raw"("a_airtable_id" text, "b_airtable_id" text);
\copy "_m2m_items_ecommerce_ecommerce__raw"("a_airtable_id","b_airtable_id") FROM :'basedir'/'csv/_m2m_items_ecommerce_ecommerce__raw.csv' WITH (FORMAT csv, HEADER true);
INSERT INTO "_m2m_items_ecommerce_ecommerce"("items_id", "ecommerce_id")
SELECT a.nocopk, b.nocopk
FROM "_m2m_items_ecommerce_ecommerce__raw" r
JOIN "items" a ON a.airtable_id = r.a_airtable_id
JOIN "ecommerce" b ON b.airtable_id = r.b_airtable_id;
DROP TABLE "_m2m_items_ecommerce_ecommerce__raw";

-- Link field: ecommerce.item_id -> items
CREATE TEMP TABLE "_m2m_ecommerce_items_item_id__raw"("a_airtable_id" text, "b_airtable_id" text);
\copy "_m2m_ecommerce_items_item_id__raw"("a_airtable_id","b_airtable_id") FROM :'basedir'/'csv/_m2m_ecommerce_items_item_id__raw.csv' WITH (FORMAT csv, HEADER true);
INSERT INTO "_m2m_ecommerce_items_item_id"("ecommerce_id", "items_id")
SELECT a.nocopk, b.nocopk
FROM "_m2m_ecommerce_items_item_id__raw" r
JOIN "ecommerce" a ON a.airtable_id = r.a_airtable_id
JOIN "items" b ON b.airtable_id = r.b_airtable_id;
DROP TABLE "_m2m_ecommerce_items_item_id__raw";

-- Link field: ecommerce.strain_id -> strains
CREATE TEMP TABLE "_m2m_ecommerce_strains_strain_id__raw"("a_airtable_id" text, "b_airtable_id" text);
\copy "_m2m_ecommerce_strains_strain_id__raw"("a_airtable_id","b_airtable_id") FROM :'basedir'/'csv/_m2m_ecommerce_strains_strain_id__raw.csv' WITH (FORMAT csv, HEADER true);
INSERT INTO "_m2m_ecommerce_strains_strain_id"("ecommerce_id", "strains_id")
SELECT a.nocopk, b.nocopk
FROM "_m2m_ecommerce_strains_strain_id__raw" r
JOIN "ecommerce" a ON a.airtable_id = r.a_airtable_id
JOIN "strains" b ON b.airtable_id = r.b_airtable_id;
DROP TABLE "_m2m_ecommerce_strains_strain_id__raw";
COMMIT;
